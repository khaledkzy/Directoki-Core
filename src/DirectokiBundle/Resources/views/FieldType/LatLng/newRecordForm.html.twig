{##
#  @license 3-clause BSD
#  @link https://github.com/Directoki/Directoki-Core/blob/master/LICENSE.txt
##}
<div id="fieldLatLng{{ field.publicId }}">
    <div id="fieldLatLng{{ field.publicId }}Lat">
        {{  form_row(form[field.publicId ~ "_lat"]) }}
    </div>
    <div id="fieldLatLng{{ field.publicId }}Lng">
        {{  form_row(form[field.publicId ~ "_lng"]) }}
    </div>
    <div id="fieldLatLng{{ field.publicId }}Map" style="width: 100%; height: 300px;"></div>

    <script>
        var map{{ field.publicId }};
        var marker{{ field.publicId }};
        $(document).ready(function() {
            map{{ field.publicId }} =  L.map('fieldLatLng{{ field.publicId }}Map').setView([55, 3], 5);
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map{{ field.publicId }});
            map{{ field.publicId }}.on('click', onMap{{ field.publicId }}Click);
        });

        function onMap{{ field.publicId }}Click(e) {
            var lat = e.latlng.lat;
            var lng = e.latlng.lng;

            if (!marker{{ field.publicId }}) {
                marker{{ field.publicId }} = L.marker([lat, lng]);
                marker{{ field.publicId }}.addTo(map{{ field.publicId }});
            } else {
                marker{{ field.publicId }}.setLatLng( e.latlng );
            }

            $('#fieldLatLng{{ field.publicId }}Lat input').val(lat);
            $('#fieldLatLng{{ field.publicId }}Lng input').val(lng);
        }

    </script>
</div>
